---
- name: "Vim Plug: Checking if is installed"
  ansible.builtin.stat:
    path: "{{ ansible_env.HOME }}/.local/share/nvim/site/autoload/plug.vim"
  register: vimplug

- name: "Vim Plug: Checking if autoload directory is present"
  when: not vimplug.stat.exists
  ansible.builtin.stat:
    path: "{{ ansible_env.HOME }}/.local/share/nvim/site/autoload"
  register: nvim_autoload

- name: "Vim Plug: Creating autoload directory"
  when: not vimplug.stat.exists and not nvim_autoload.stat.exists
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.local/share/nvim/site/autoload"
    state: directory
    mode: "750"
    owner: "{{ ansible_user_id }}"
    group: "{{ ansible_user_id }}"

- name: "Vim Plug: Downloading"
  when: not vimplug.stat.exists
  ansible.builtin.get_url:
    url: https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    dest: "{{ ansible_env.HOME }}/.local/share/nvim/site/autoload"
    mode: "664"

- name: "Vim Plug: Installing/Updating plugins"
  ansible.builtin.command: nvim --headless +PlugUpdate +qall
  register: vimplug_plugins
  changed_when: vimplug_plugins.rc != 0
