---
- name: "NVM: Checking if is installed"
  ansible.builtin.stat:
    path: "{{ ansible_env.HOME }}/.config/nvm"
  register: nvm_exists

- name: "NVM: Getting latest tag name"
  when: nvm_exists.stat.isdir is undefined
  ansible.builtin.uri:
    url: https://api.github.com/repos/nvm-sh/nvm/releases/latest
  register: result

- name: "NVM: Installing"
  when: nvm_exists.stat.isdir is undefined
  ansible.builtin.shell:
    cmd: |
      set -o pipefail
      curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/{{ result.json.tag_name }}/install.sh
    executable: /bin/bash
  register: nvm_script
  changed_when: nvm_script.rc != 0

- name: "NVM: Last steps"
  when: nvm_exists.stat.isdir is undefined
  ansible.builtin.debug:
    msg:
      - "- Open a new terminal session"
      - "- run `nvm install node`"
      - "- You're done!"
